{% extends 'base.html' %}
{% load static %}
{% block content %}

<div class="nav nav-pills" style="background-color: white;">
    <div>
        <img src="{% static 'assets/logoGreen.png' %}" alt="logo">
    </div>

    <div class="pestanyes">
        <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="#">Home</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="aboutUs.html">About Us</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="">Contact</a>
        </li>
    </div>

    {% if user.is_authenticated %}
    <div class="supersuperfuturistic-button">
        <form id="logout-form" action="{% url 'logout' %}" method="post">
            {% csrf_token %}
            <button type="submit" class="btn btn-futuristic btn-sm rounded-pill">
                <span class="text-visible"> Log Out</span>
            </button>
        </form>
    </div>
    {% endif %}
</div>

<body style="background-image: url('{% static 'assets/alimentos.jpg' %}'); background-size: cover;">
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">Calendario</div>
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <a href="?date={{ previous_date|date:'Y-m-d' }}" class="btn btn-primary" style="background-color: #036243;">&lt; Anterior</a>
                        <h2 style="text-decoration: underline; font-weight: bold;">{{ current_date }}</h2>
                        <a href="?date={{ next_date|date:'Y-m-d' }}" class="btn btn-primary" style="background-color: #036243;">Siguiente &gt;</a>
                    </div>
                    <!-- Mostrar los platos para el día actual -->
                    <h3 class="mb-3">Platos para el día {{ current_date }}</h3>
                    <ul class="list-group">
                        {% for plato in platos %}
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            {{ plato.name }}
                            <div class="btn-group" role="group" aria-label="Actions">
                                <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deletePlatoModal" data-plato-id="{{ plato.id }}" data-plato-name="{{ plato.name }}">Eliminar</button>
                                <button class="btn btn-primary" style="background-color: #036243;" data-bs-toggle="modal" data-bs-target="#modifyPlatoModal" data-plato-id="{{ plato.id }}" data-plato-name="{{ plato.name }}">Modificar</button>
                            </div>
                        </li>
                        {% empty %}
                        <li class="list-group-item">No hay platos guardados para este día.</li>
                        {% endfor %}
                    </ul>
                    <button class="btn btn-primary mt-3" data-bs-toggle="modal" data-bs-target="#addPlatoModal" style="background-color: #036243;">Agregar Plato</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal para agregar plato -->
<div class="modal fade" id="addPlatoModal" tabindex="-1" aria-labelledby="addPlatoModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addPlatoModalLabel">Agregar Plato</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form method="post" action="{% url 'seleccionar_dia' %}?date={{ current_date }}">
                    {% csrf_token %}
                    {{ add_form.as_p }}
                    <button type="submit" class="btn btn-success mt-3">Agregar plato</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Modal para eliminar plato -->
<div class="modal fade" id="deletePlatoModal" tabindex="-1" aria-labelledby="deletePlatoModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deletePlatoModalLabel">Confirmar eliminación de plato</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p id="deletePlatoMessage"></p>
                <form id="deletePlatoForm" method="post" action="{% url 'seleccionar_dia' %}?date={{ current_date }}">
                    {% csrf_token %}
                    <input type="hidden" id="deletePlatoId" name="plato_id" required>
                    <button type="submit" class="btn btn-danger" name="delete">Confirmar eliminación</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Modal para modificar plato -->
<div class="modal fade" id="modifyPlatoModal" tabindex="-1" aria-labelledby="modifyPlatoModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modifyPlatoModalLabel">Modificar Plato</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="modifyPlatoForm" method="post" action="{% url 'seleccionar_dia' %}?date={{ current_date }}">
                    {% csrf_token %}
                    <input type="hidden" id="modifyPlatoId" name="plato_id" required>
                    {{ modify_form.as_p }}
                    <button type="submit" class="btn btn-success mt-3" name="modify">Guardar Cambios</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        var deletePlatoModal = document.getElementById('deletePlatoModal');
        deletePlatoModal.addEventListener('show.bs.modal', function (event) {
            var button = event.relatedTarget;
            var platoId = button.getAttribute('data-plato-id');
            var platoName = button.getAttribute('data-plato-name');
            var deletePlatoId = document.getElementById('deletePlatoId');
            var deletePlatoMessage = document.getElementById('deletePlatoMessage');
            deletePlatoId.value = platoId;
            deletePlatoMessage.textContent = '¿Estás seguro que deseas eliminar el plato "' + platoName + '"?';
        });

        var modifyPlatoModal = document.getElementById('modifyPlatoModal');
        modifyPlatoModal.addEventListener('show.bs.modal', function (event) {
            var button = event.relatedTarget;
            var platoId = button.getAttribute('data-plato-id');
            var modifyPlatoId = document.getElementById('modifyPlatoId');
            modifyPlatoId.value = platoId;
        });
    });
</script>

{% endblock %}
